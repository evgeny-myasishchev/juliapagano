#!/usr/bin/env node

'use strict';

//Load initial data into mongo database

const _ = require('lodash');
const co = require('co');
const initialData = require('../data/initial-data');
const Mongo = require('../app/lib/Mongo');
const logger = require('../app/logging').getLogger('INITIAL-DATA');

const db = new Mongo();

co(function * () {
  yield db.connect();

  logger.info(`Writting pages: ${initialData.pages.length}`);
  const pages = db.collection('pages');
  yield pages.bulkWrite(
    initialData.pages.map((page) => ({
      insertOne: {
        document: _.assign({
          _id: page.id
        }, _.omit(page, 'id'))
      }
    })
  ));
  logger.info('Initial data loaded into mongo');
})
.then(() => db.close())
.catch((err) => {
  logger.error(`Failed to load initial data`);
  logger.info(err.stack);
  return db.close();
});
